"""
dependency_check.py: Check for required binaries and Python packages for malyz3r
"""
import shutil
import importlib
from malware_scanner.utils import print_result

REQUIRED_BINARIES = [
    ("yara", "YARA binary for command-line scans"),
    ("exiftool", "ExifTool for metadata extraction"),
    ("strings", "strings utility for investigation"),
    ("hexdump", "hexdump utility for investigation"),
]

REQUIRED_PYTHON_PACKAGES = [
    ("yara", "yara-python for YARA scanning"),
    ("pefile", "pefile for digital signature checks"),
    ("magic", "python-magic for file type detection"),
]

def check_binaries():
    missing = []
    for binary, desc in REQUIRED_BINARIES:
        if shutil.which(binary) is None:
            print_result(f"[Dependency] Missing: {binary} ({desc})", "error")
            missing.append(binary)
    return missing

def check_python_packages():
    missing = []
    for pkg, desc in REQUIRED_PYTHON_PACKAGES:
        if importlib.util.find_spec(pkg) is None:
            print_result(f"[Dependency] Missing Python package: {pkg} ({desc})", "error")
            missing.append(pkg)
    return missing

def check_all_dependencies():
    missing_bin = check_binaries()
    missing_pkg = check_python_packages()
    if not missing_bin and not missing_pkg:
        print_result("[Dependency] All required dependencies are installed.", "success")
    return missing_bin, missing_pkg
